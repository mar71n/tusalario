<html>
<head>
<style>
table {
    background: url(NORecibo_en_Blanco.png) transparent no-repeat 22 0; 
    background-size: cover; 
    font-size: 22px; 
    width: 640px; 
    height: 480px; 
    border: none; 
    color: red; 
    text-align: center; 
}
th{
    height: 300px;
}
input[type="text"]
{
    background: transparent;
    // border: none;
}
td.columna0{
    width: 52px;
}
input.columna0{
    width: 52px;
}
input.columna1{
    width: 200;
    text-align:left;
}
input.columna2{
    width: 90;
    text-align:right;
}
input.columna3{
    width: 90;
    text-align:right;
}
input.columna4{
    width: 200;
    text-align:left;
}
input.columna5{
    width: 87;
    text-align:right;
}
input.columna6{
    width: 87;
    text-align:right;
}
</style>
<script language="javascript" type="text/javascript"> 
var recibo = {};
recibo = (function(){
    // privadas
    var mostrarFilas = 18;
    var mostrarColumnas = 7;
    // API publico
    return {
        // ponerTabla
        ponerTabla: function (){
            var columnas = mostrarColumnas;
            var filas = mostrarFilas;
            var laTabla = '';
            var primerfila = '<tr>';
            for (var c = 0; c < columnas; c++){
                primerfila = primerfila + '<th> </th>';
            }
            laTabla = '';
            for (var f = 0; f < filas; f++){
                laTabla = laTabla + '<tr>';
                laTabla = laTabla +  ' <td class="columna0"> <input type="checkbox" class="columna0 fila' + f + '"/>  </td>';
                for (var c = 1; c < columnas; c++){
                    laTabla = laTabla +  ' <td> <input type="text" class="columna' + c + ' fila' + f + '"/>  </td>';
                }
                laTabla = laTabla +  '<tr>';
            }
            primerfila = primerfila + "</th></tr>";
            laTabla = '<table >' + primerfila + laTabla + '</table>';
            document.write(laTabla);
        },
        // grabarColumna
        grabarColumna: function (columna){
            var losinputs = document.getElementsByClassName("columna" + columna);
            var largo = losinputs.length;
            var coln = new Array();
            var inps0 = 0;
            for (inps=0 ; inps < largo; inps++){
                if (losinputs[inps].tagName == "INPUT"){
                    if(losinputs[inps].checked){
                        coln[inps0]=losinputs[inps].checked;
                    }else{
                        coln[inps0]=losinputs[inps].value;
                    }
                    inps0++;
                }
            }
            localStorage["col"+columna]=coln;
        },
        // grabarFila
        grabarFila: function(fila,clave){
            var losinputs = document.getElementsByClassName("fila" + fila);
            var filn = new Array();
            // remunerativo/no remunerativo: columna 0
            filn[0] = document.getElementsByClassName("fila" + fila + " columna0")[0].checked;
            // haberes: columan 1 2 3
            filn[1] = document.getElementsByClassName("fila" + fila + " columna1")[0].value;
            filn[2] = document.getElementsByClassName("fila" + fila + " columna2")[0].value;
            filn[3] = document.getElementsByClassName("fila" + fila + " columna3")[0].value;
            // descuentos: columan 4 5 6
            filn[4] = document.getElementsByClassName("fila" + fila + " columna4")[0].value;
            filn[5] = document.getElementsByClassName("fila" + fila + " columna5")[0].value;
            filn[6] = document.getElementsByClassName("fila" + fila + " columna6")[0].value;
            // grabar
            localStorage[clave+"fila"+fila]=filn;
        },
        // grabar
        grabar: function (){
            // aca pongo la clave de recibo: año.mes.numero (puede haber mas de uno en un mes, SAC, aumentos, etc.)
            clave = document.getElementById("annio").value + document.getElementById("mes").value + document.getElementById("numero").value;
            for (f=0; f < mostrarFilas; f++){
                this.grabarFila(f,clave);
            }
            // refresco la botonera
            recibo.ponerRecibos();
        },
        // recuperarFila
        recuperarFila: function(fila,clave){
            var losinputs = document.getElementsByClassName("fila" + fila);
            var filn = new Array();
            filn = localStorage.getItem(clave + "fila" + fila).split(",");
            //console.debug(filn);
            // remunerativo/no remunerativo: columna 0
            if (filn[0] == "true"){
                document.getElementsByClassName("fila" + fila + " columna0")[0].checked = true;
            } else {
                document.getElementsByClassName("fila" + fila + " columna0")[0].checked = false;
            }
            // haberes: columan 1 2 3
            document.getElementsByClassName("fila" + fila + " columna1")[0].value   = filn[1];
            document.getElementsByClassName("fila" + fila + " columna2")[0].value   = filn[2];
            document.getElementsByClassName("fila" + fila + " columna3")[0].value   = filn[3];
            // descuentos: columan 4 5 6
            document.getElementsByClassName("fila" + fila + " columna4")[0].value   = filn[4];
            document.getElementsByClassName("fila" + fila + " columna5")[0].value   = filn[5];
            document.getElementsByClassName("fila" + fila + " columna6")[0].value   = filn[6];
        },
        // recuperar
        recuperar: function (clave){
            // aca, previo a recuperar tengo que elegir entre los grabados
            //clave = document.getElementById("annio").value + document.getElementById("mes").value + document.getElementById("numero").value;
            for (f=0; f < mostrarFilas; f++){
                this.recuperarFila(f,clave);
            }
            // pongo en los desplegables la clave
            document.getElementById("annio").value = clave.toString().substr(0,4);
            document.getElementById("mes").value = clave.toString().substr(4,2);
            document.getElementById("numero").value = clave.toString().substr(6,2);
        },
        // pegarFilas
        pegarFilas: function(){
            var lineas = document.getElementsByTagName('div');
            haberes = true;
            for (j=0 ; j < lineas.length + 1; j++){
                // var losinputs = document.getElementsByClassName("fila" + j);
                //console.debug(lineas.item(j).childNodes[0]);
                var valor = document.getElementsByTagName('div').item(j+1).childNodes[0].textContent.match(/[-]*[0-9]+\.[0-9]+/i);
                var descripcion = document.getElementsByTagName('div').item(j+1).childNodes[0].textContent.replace(/[-]*[0-9]+\.[0-9]+/i,"");
                //console.debug(descripcion + " ....... " + valor);
                if (! (descripcion.length > 0)){
                    haberes = false;
                    xj = j + 1 ;
                }
                if(haberes && (descripcion.length > 0)){
                    // haberes: columan 1 2 3
                    document.getElementsByClassName("fila" + j + " columna1")[0].value   = descripcion;
                    document.getElementsByClassName("fila" + j + " columna2")[0].value   = valor;
                    //document.getElementsByClassName("fila" + fila + " columna3")[0].value   = filn[3];
                }
                if(haberes == false  && descripcion.length > 0){
                    // descuentos: columan 4 5 6
                    document.getElementsByClassName("fila" + (j-xj) + " columna4")[0].value   = descripcion;
                    document.getElementsByClassName("fila" + (j-xj) + " columna5")[0].value   = valor;
                    //document.getElementsByClassName("fila" + fila + " columna6")[0].value   = filn[6];
                }
            }
        },
        // lista de recibos grabados
        listaRecibos: function(){
            var nclaves = localStorage.length;
            var claves = new Array();
            var kn = 0;
            for (kls = 0 ; kls < nclaves; kls++){
                clave = localStorage.key(kls);
                clave = clave.substr(0,8);
                if (clave==clave.match(/20[0-9]{2}[01][0-9][012][0-9]/)){
                    claves[kn]=clave;
                    kn++;
                }
            }
            claves.sort();
            nclaves = claves.length;
            var clave_0 = "";
            var clavestodas = new Array();
            kn = 0;
            for (kls = 0 ; kls < nclaves; kls++){
                if(claves[kls] != clave_0){
                    clavestodas[kn]=claves[kls]
                    kn++;
                    clave_0 = claves[kls];
                    //console.debug(claves[kls]);
                }
            }
            return clavestodas;
        },
        ponerRecibos:function(){
            document.getElementById("botonera_recibos").innerHTML = "";
            losrecibos = this.listaRecibos();
            cuantos = losrecibos.length;
            var losbotones = "";
            for(k = 0; k < cuantos; k++){
                //document.write("<input type='button' onClick='recibo.recuperar(" + losrecibos[k] + ")' value='" + losrecibos[k] + "'>");
                losbotones = losbotones + " <input type='button' onClick='recibo.recuperar(" + losrecibos[k] + ")' value='" + losrecibos[k] + "'> ";
            }
            document.getElementById("botonera_recibos").innerHTML = losbotones;
        }
    }
}())
function runTotal(myForm) { 
    //el código va aquí //declara las variables y asigna box1 y box2. 
    var form_field1 = Number(myForm.box1.value); 
    var form_field2 = Number(myForm.box2.value); 
    //add the variables and update the total field value with the result. 
    myForm.total.value = form_field1 + form_field2; 
}
(function(){
    //recibo.listaRecibos();
}()) 
</script> </head>
<body>
<div id="botonera_recibos"> 
<script>recibo.ponerRecibos();</script>
</div>
<form id="recibo">
<script>recibo.ponerTabla();</script>
<p></p>
<select id="annio">
    <option value="2012">2012</option>
    <option value="2013">2013</option>
    <option value="2014" selected="selected">2014</option>
</select>
<select id="mes">
    <option value="01">01</option>
    <option value="02">02</option>
    <option value="03">03</option>
    <option value="04">04</option>
    <option value="05">05</option>
    <option value="06">06</option>
    <option value="07">07</option>
    <option value="08">08</option>
    <option value="09">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
</select>
<select id="numero">
    <option value="01">01</option>
    <option value="02">02</option>
    <option value="03">03</option>
</select>
<input type="button" onClick="recibo.grabar()" value="Grabar recibo">
<input type="reset" value="Limpiar recibo">
</form>

<div contenteditable="true" id="pegado"> Pegue desde Haberes asta el último importe AQUI </div>
<p><input type='button' value='mostra' onclick='recibo.pegarFilas()'>
<script  language="javascript" type="text/javascript">
</script>
</body>
</html>